{% extends 'base.html' %}
{% load static %}

{% block title %}Manage Users - Admin Dashboard{% endblock %}

{% block extra_css %}
<style>
  .admin-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem 0;
    margin-bottom: 2rem;
  }

  .admin-header h1 {
    margin-bottom: 0.5rem;
  }

  .filters-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-bottom: 2rem;
  }

  .filter-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    align-items: end;
  }

  .form-control, .form-select {
    border-radius: 8px;
    border: 1px solid #ddd;
    padding: 0.75rem;
  }

  .form-control:focus, .form-select:focus {
    border-color: var(--brand-start);
    box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
  }

  .btn-filter {
    background: linear-gradient(135deg, #ff6b6b, #ff5252);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
  }

  .btn-filter:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
  }

  .users-table {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .table {
    margin-bottom: 0;
  }

  .table thead {
    background: #f8f9fa;
    border-bottom: 2px solid #eee;
  }

  .table th {
    font-weight: bold;
    color: #333;
    padding: 1rem;
    vertical-align: middle;
  }

  .table td {
    padding: 1rem;
    vertical-align: middle;
  }

  .table tbody tr:hover {
    background: #f5f5f5;
  }

  .user-cell {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 0.9rem;
  }

  .user-info h6 {
    margin-bottom: 0.25rem;
    font-weight: bold;
  }

  .user-info p {
    margin-bottom: 0;
    font-size: 0.85rem;
    color: #666;
  }

  .role-badge {
    display: inline-block;
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: bold;
  }

  .role-badge-artist {
    background: #e3f2fd;
    color: #1976d2;
  }

  .role-badge-host {
    background: #f3e5f5;
    color: #7b1fa2;
  }

  .role-badge-user {
    background: #e8f5e9;
    color: #388e3c;
  }

  .actions-cell {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .btn-sm {
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-view {
    background: #e3f2fd;
    color: #1976d2;
  }

  .btn-view:hover {
    background: #bbdefb;
  }

  .btn-promote {
    background: #fff3e0;
    color: #f57c00;
  }

  .btn-promote:hover {
    background: #ffe0b2;
  }

  .pagination {
    justify-content: center;
    margin-top: 2rem;
    gap: 0.5rem;
  }

  .pagination .page-link {
    border-radius: 6px;
    border: 1px solid #ddd;
    color: var(--brand-start);
  }

  .pagination .page-item.active .page-link {
    background: linear-gradient(135deg, #ff6b6b, #ff5252);
    border-color: var(--brand-start);
  }

  .pagination .page-link:hover {
    background: #f5f5f5;
  }

  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #666;
  }

  .empty-state i {
    font-size: 3rem;
    color: #ddd;
    margin-bottom: 1rem;
    display: block;
  }

  .joined-date {
    color: #999;
    font-size: 0.85rem;
  }

  .badge {
    padding: 0.35rem 0.65rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: bold;
  }

  .badge-active {
    background: #d4edda;
    color: #155724;
  }

  .badge-inactive {
    background: #f8d7da;
    color: #721c24;
  }
</style>
{% endblock %}

{% block content %}
<!-- Admin Header -->
<div class="admin-header">
  <div class="container">
    <h1><i class="bi bi-people"></i> Manage Users</h1>
    <p class="text-white-50 mb-0">View and manage all platform users</p>
  </div>
</div>

<div class="container">
  <!-- Filters -->
  <div class="filters-card">
    <form method="get" class="filter-row">
      <div>
        <label for="search" class="form-label mb-2">Search Users</label>
        <input 
          type="text" 
          id="search" 
          name="search" 
          class="form-control" 
          placeholder="Search by name or email..."
          value="{{ search }}"
        >
      </div>

      <div>
        <label for="role" class="form-label mb-2">Filter by Role</label>
        <select id="role" name="role" class="form-select">
          <option value="">All Roles</option>
          <option value="artist" {% if role_filter == 'artist' %}selected{% endif %}>Artists</option>
          <option value="host" {% if role_filter == 'host' %}selected{% endif %}>Event Hosts</option>
          <option value="regular" {% if role_filter == 'regular' %}selected{% endif %}>Regular Users</option>
        </select>
      </div>

      <button type="submit" class="btn-filter">
        <i class="bi bi-funnel"></i> Filter
      </button>
    </form>
  </div>

  <!-- Users Table -->
  <div class="users-table">
    {% if page_obj %}
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th style="width: 40%;">User</th>
            <th style="width: 20%;">Roles</th>
            <th style="width: 20%;">Joined</th>
            <th style="width: 20%;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for user in page_obj %}
          <tr>
            <td>
              <div class="user-cell">
                <div class="user-avatar">
                  {{ user.first_name|default:user.email|first|upper }}
                </div>
                <div class="user-info">
                  <h6>{{ user.get_full_name|default:user.email }}</h6>
                  <p>{{ user.email }}</p>
                </div>
              </div>
            </td>
            <td>
              {% if user.is_artist %}
                <span class="role-badge role-badge-artist">
                  <i class="bi bi-person-video"></i> Artist
                </span>
              {% endif %}
              {% if user.is_host %}
                <span class="role-badge role-badge-host">
                  <i class="bi bi-calendar-event"></i> Host
                </span>
              {% endif %}
              {% if not user.is_artist and not user.is_host %}
                <span class="role-badge role-badge-user">
                  <i class="bi bi-person"></i> Regular
                </span>
              {% endif %}
            </td>
            <td>
              <span class="joined-date">{{ user.date_joined|date:'M d, Y' }}</span>
            </td>
            <td>
              <div class="actions-cell">
                <a href="{% url 'accounts:view_user_profile' user.pk %}" class="btn-sm btn-view" title="View Profile">
                  <i class="bi bi-eye"></i> View
                </a>
                <button class="btn-sm btn-promote" onclick="alert('Feature coming soon')" title="Edit User">
                  <i class="bi bi-pencil"></i> Edit
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Pagination -->
      {% if page_obj.has_other_pages %}
      <nav class="d-flex justify-content-center p-3">
        <ul class="pagination">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page=1{% if search %}&search={{ search }}{% endif %}{% if role_filter %}&role={{ role_filter }}{% endif %}">
                <i class="bi bi-chevron-double-left"></i>
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if role_filter %}&role={{ role_filter }}{% endif %}">
                <i class="bi bi-chevron-left"></i> Previous
              </a>
            </li>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
              <li class="page-item active">
                <span class="page-link">{{ num }}</span>
              </li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <li class="page-item">
                <a class="page-link" href="?page={{ num }}{% if search %}&search={{ search }}{% endif %}{% if role_filter %}&role={{ role_filter }}{% endif %}">
                  {{ num }}
                </a>
              </li>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if role_filter %}&role={{ role_filter }}{% endif %}">
                Next <i class="bi bi-chevron-right"></i>
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}{% if role_filter %}&role={{ role_filter }}{% endif %}">
                <i class="bi bi-chevron-double-right"></i>
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    {% else %}
      <div class="empty-state">
        <i class="bi bi-inbox"></i>
        <h4>No users found</h4>
        <p>Try adjusting your search or filter criteria</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
