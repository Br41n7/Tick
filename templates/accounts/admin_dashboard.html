{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard - Tick Entertainment{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<style>
  .stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 1rem;
  }
  .stat-card.users { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
  .stat-card.events { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
  .stat-card.bookings { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
  .stat-card.revenue { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
  .stat-card h6 { opacity: 0.9; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem; }
  .stat-card .value { font-size: 2rem; font-weight: bold; }
  .stat-card .change { font-size: 0.8rem; opacity: 0.8; margin-top: 0.5rem; }

  .dashboard-container { padding: 2rem 0; }
  .section-title { font-size: 1.3rem; font-weight: bold; margin-top: 2rem; margin-bottom: 1rem; border-bottom: 3px solid var(--brand-start); padding-bottom: 0.5rem; display: inline-block; }
  
  .chart-container { position: relative; height: 300px; margin-bottom: 2rem; background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
  
  .list-card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow: hidden; }
  .list-card .card-header { background: #f8f9fa; padding: 1rem 1.5rem; border-bottom: 1px solid #eee; font-weight: bold; }
  .list-item { padding: 1rem 1.5rem; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
  .list-item:last-child { border-bottom: none; }
  .list-item .badge { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: bold; }

  .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1.5rem; }
  .quick-action-btn { padding: 1rem; border-radius: 12px; border: 1px solid #ddd; text-align: center; transition: all 0.3s ease; text-decoration: none; color: inherit; }
  .quick-action-btn:hover { border-color: var(--brand-start); box-shadow: 0 4px 12px rgba(255,107,107,0.2); transform: translateY(-2px); }
  .quick-action-btn i { font-size: 1.5rem; margin-bottom: 0.5rem; display: block; color: var(--brand-start); }
  .quick-action-btn span { display: block; font-size: 0.85rem; font-weight: bold; }

  .status-badge-pending { background: #fff3cd; color: #856404; }
  .status-badge-approved { background: #d4edda; color: #155724; }
  .status-badge-rejected { background: #f8d7da; color: #721c24; }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <!-- Header -->
  <div class="mb-5">
    <h1 class="mb-2">Admin Dashboard</h1>
    <p class="text-muted">Welcome back! Here's your platform overview at a glance.</p>
  </div>

  <!-- Key Statistics Cards -->
  <div class="row mb-5">
    <div class="col-md-6 col-lg-3">
      <div class="stat-card users">
        <h6>Total Users</h6>
        <div class="value">{{ total_users }}</div>
        <div class="change"><i class="bi bi-arrow-up"></i> Active accounts</div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3">
      <div class="stat-card events">
        <h6>Total Events</h6>
        <div class="value">{{ total_events }}</div>
        <div class="change"><i class="bi bi-arrow-right"></i> {{ published_events }} published</div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3">
      <div class="stat-card bookings">
        <h6>Total Bookings</h6>
        <div class="value">{{ total_bookings }}</div>
        <div class="change"><i class="bi bi-calendar-check"></i> Confirmed bookings</div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3">
      <div class="stat-card revenue">
        <h6>Total Revenue</h6>
        <div class="value">${{ total_revenue|floatformat:0 }}</div>
        <div class="change"><i class="bi bi-cash-coin"></i> From confirmed bookings</div>
      </div>
    </div>
  </div>

  <!-- Role Breakdown -->
  <div class="row mb-5">
    <div class="col-md-6">
      <div class="list-card">
        <div class="card-header">
          <i class="bi bi-person-badge"></i> User Roles
        </div>
        <div class="list-item">
          <span>Artists</span>
          <span class="badge" style="background: #e3f2fd; color: #1976d2;">{{ total_artists }}</span>
        </div>
        <div class="list-item">
          <span>Event Hosts</span>
          <span class="badge" style="background: #f3e5f5; color: #7b1fa2;">{{ total_hosts }}</span>
        </div>
        <div class="list-item">
          <span>Regular Users</span>
          <span class="badge" style="background: #e8f5e9; color: #388e3c;">{{ regular_users }}</span>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="list-card">
        <div class="card-header">
          <i class="bi bi-hourglass"></i> Pending Role Requests
        </div>
        {% if pending_requests %}
          {% for req in pending_requests %}
          <div class="list-item">
            <div>
              <strong>{{ req.user.get_full_name }}</strong>
              <br><small class="text-muted">{{ req.get_request_type_display }}</small>
            </div>
            <a href="{% url 'accounts:verify_kyc' req.pk %}" class="btn btn-sm btn-primary">Review</a>
          </div>
          {% endfor %}
        {% else %}
          <div class="list-item text-muted">No pending requests</div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="mb-5">
    <h5 class="section-title"><i class="bi bi-lightning"></i> Quick Actions</h5>
    <div class="quick-actions">
      <a href="{% url 'accounts:admin_dashboard' %}" class="quick-action-btn">
        <i class="bi bi-graph-up"></i>
        <span>Analytics</span>
      </a>
      <a href="{% url 'accounts:manage_users' %}" class="quick-action-btn">
        <i class="bi bi-people"></i>
        <span>Manage Users</span>
      </a>
      <a href="{% url 'accounts:manage_role_requests' %}" class="quick-action-btn">
        <i class="bi bi-clipboard-check"></i>
        <span>Role Requests</span>
      </a>
      <a href="{% url 'events:event_list' %}" class="quick-action-btn">
        <i class="bi bi-calendar-event"></i>
        <span>Events</span>
      </a>
      <a href="{% url 'artists:artist_list' %}" class="quick-action-btn">
        <i class="bi bi-person-video"></i>
        <span>Artists</span>
      </a>
      <a href="/admin/" class="quick-action-btn">
        <i class="bi bi-gear"></i>
        <span>Django Admin</span>
      </a>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="row">
    <div class="col-lg-6">
      <h5 class="section-title"><i class="bi bi-clock-history"></i> Recent Users</h5>
      <div class="list-card">
        {% if recent_users %}
          {% for user in recent_users %}
          <div class="list-item">
            <div>
              <strong>{{ user.get_full_name }}</strong>
              <br><small class="text-muted">{{ user.email }}</small>
            </div>
            <small class="text-muted">{{ user.date_joined|date:'short' }}</small>
          </div>
          {% endfor %}
        {% else %}
          <div class="list-item text-muted">No users yet</div>
        {% endif %}
      </div>
    </div>

    <div class="col-lg-6">
      <h5 class="section-title"><i class="bi bi-calendar-check"></i> Recent Events</h5>
      <div class="list-card">
        {% if recent_events %}
          {% for event in recent_events %}
          <div class="list-item">
            <div>
              <strong>{{ event.title }}</strong>
              <br><small class="text-muted">{{ event.host.get_full_name }}</small>
            </div>
            <span class="badge status-badge-{% if event.status == 'published' %}approved{% else %}pending{% endif %}">{{ event.get_status_display }}</span>
          </div>
          {% endfor %}
        {% else %}
          <div class="list-item text-muted">No events yet</div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Charts Section (Optional - add more analytics) -->
  <div class="row mt-5">
    <div class="col-lg-6">
      <h5 class="section-title"><i class="bi bi-bar-chart"></i> User Growth</h5>
      <div class="chart-container">
        <canvas id="userChart"></canvas>
      </div>
    </div>
    <div class="col-lg-6">
      <h5 class="section-title"><i class="bi bi-pie-chart"></i> Role Distribution</h5>
      <div class="chart-container">
        <canvas id="roleChart"></canvas>
      </div>
    </div>
  </div>

</div>

<script>
  // User Growth Chart (Mock data - update with real data from backend)
  const userCtx = document.getElementById('userChart');
  if (userCtx) {
    new Chart(userCtx, {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
          label: 'New Users',
          data: [12, 19, 3, 5, 2, 3],
          borderColor: 'var(--brand-start)',
          backgroundColor: 'rgba(255, 107, 107, 0.1)',
          tension: 0.4,
          fill: true,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: true } }
      }
    });
  }

  // Role Distribution Chart
  const roleCtx = document.getElementById('roleChart');
  if (roleCtx) {
    new Chart(roleCtx, {
      type: 'doughnut',
      data: {
        labels: ['Artists', 'Hosts', 'Regular Users'],
        datasets: [{
          data: [{{ total_artists }}, {{ total_hosts }}, {{ regular_users }}],
          backgroundColor: ['#f093fb', '#764ba2', '#667eea'],
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: true, position: 'bottom' } }
      }
    });
  }
</script>
{% endblock %}
